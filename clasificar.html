<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CohortLab — Clasificador Clínico</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
:root {
  --verde: #2b7a58;
  --verde-claro: #4aba84;
  --gris-fondo: #f6f7f6;
  --gris-borde: #e5e7eb;
}
body {
  font-family: "Inter", sans-serif;
  background-color: var(--gris-fondo);
  color: #1b1b1b;
}
header {
  background: white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  border-bottom: 1px solid var(--gris-borde);
}
.card {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
.btn {
  background: var(--verde);
  color: white;
  padding: 0.6rem 1.2rem;
  border-radius: 0.5rem;
  font-weight: 600;
  transition: 0.25s;
}
.btn:hover { background: var(--verde-claro); }
.progress-bar {
  height: 8px;
  border-radius: 9999px;
  background-color: #edf2f7;
  overflow: hidden;
}
.progress-inner {
  height: 100%;
  border-radius: 9999px;
  transition: width 0.6s ease-in-out;
}
#chatButton {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--verde);
  color: white;
  border-radius: 50%;
  width: 56px;
  height: 56px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  cursor: pointer;
  transition: 0.25s;
}
#chatButton:hover { background: var(--verde-claro); }
</style>
</head>

<body>
<header class="flex justify-between items-center px-8 py-4">
  <div class="flex items-center gap-2">
    <i data-lucide="activity" class="text-[var(--verde)]"></i>
    <h1 class="text-xl font-semibold text-[var(--verde)]">CohortLab</h1>
    <span class="text-gray-500 text-sm">Clasificador Clínico</span>
  </div>
  <a href="index.html" class="text-sm text-[var(--verde)] hover:underline">Volver al panel</a>
</header>

<main class="p-6">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto">
    <!-- Columna izquierda -->
    <div class="card">
      <h2 class="text-2xl font-bold mb-6 text-[var(--verde)]">Clasificador Clínico Inteligente</h2>

      <section class="mb-8">
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Analizar informe clínico (PDF)</h3>
        <input type="file" id="pdfFile" accept=".pdf" class="w-full border border-gray-300 rounded-md p-2 mb-3">
        <button class="btn w-full" onclick="enviarPDF()">Analizar PDF</button>
      </section>

      <hr class="my-6">

      <section>
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Introducir valores manualmente</h3>
        <p class="text-sm text-gray-500 mb-4">Modifica los valores para probar el clasificador.</p>

        <div class="grid grid-cols-3 md:grid-cols-4 gap-3 mb-4">
          <input id="glucosa" placeholder="Glucosa (mg/dL)" class="border p-2 rounded-md" value="198">
          <input id="hba1c" placeholder="HbA1c (%)" class="border p-2 rounded-md" value="8.2">
          <input id="colesterol_total" placeholder="Colesterol (mg/dL)" class="border p-2 rounded-md" value="245">
          <input id="hdl" placeholder="HDL (mg/dL)" class="border p-2 rounded-md" value="38">
          <input id="ldl" placeholder="LDL (mg/dL)" class="border p-2 rounded-md" value="165">
          <input id="trigliceridos" placeholder="Triglicéridos (mg/dL)" class="border p-2 rounded-md" value="260">
          <input id="creatinina" placeholder="Creatinina (mg/dL)" class="border p-2 rounded-md" value="1.3">
          <input id="tfg" placeholder="TFG (ml/min)" class="border p-2 rounded-md" value="60">
          <input id="sodio" placeholder="Sodio (mmol/L)" class="border p-2 rounded-md" value="138">
          <input id="potasio" placeholder="Potasio (mmol/L)" class="border p-2 rounded-md" value="4.6">
        </div>

        <button class="btn w-full" onclick="enviarValores()">Ejecutar Clasificación</button>
      </section>
    </div>

    <!-- Columna derecha -->
    <div class="card" id="panelResultados">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Resultados del Clasificador</h3>
      <div id="resultado" class="text-gray-500 text-sm">Los resultados aparecerán aquí tras ejecutar el análisis.</div>
    </div>
  </div>
</main>

<!-- Botón flotante de chat -->
<div id="chatButton" onclick="window.open('chat.html','_blank')" title="Abrir Chat Asistido">
  <i data-lucide="message-square"></i>
</div>

<script>
lucide.createIcons();

const resultadosDemo = {
  renal: {
    cohortes: {
      "Enfermedad renal crónica": 94,
      "Diabetes tipo 2": 38,
      "Síndrome metabólico": 21
    },
    explicacion: "El patrón analítico muestra un filtrado glomerular reducido y elevación moderada de creatinina. El perfil es compatible con una fase inicial de enfermedad renal crónica. Se recomienda control nefrológico y ajuste farmacológico individualizado."
  },
  diabetes: {
    cohortes: {
      "Diabetes tipo 2": 92,
      "Síndrome metabólico": 64,
      "Riesgo cardiovascular": 48
    },
    explicacion: "El perfil indica hiperglucemia mantenida y HbA1c elevada. El paciente presenta un riesgo alto de complicaciones metabólicas asociadas a diabetes tipo 2. Se aconseja refuerzo de la adherencia y seguimiento endocrinológico."
  },
  normal: {
    cohortes: {
      "Diabetes tipo 2": 4,
      "Enfermedad renal crónica": 2,
      "Síndrome metabólico": 5
    },
    explicacion: "Los valores analíticos se encuentran dentro de los rangos fisiológicos habituales. No se observan alteraciones metabólicas ni renales significativas. Se recomienda seguimiento rutinario anual."
  }
};

async function enviarPDF() {
  const fileInput = document.getElementById("pdfFile");
  if (!fileInput.files.length) return alert("Selecciona un archivo PDF.");
  const nombre = fileInput.files[0].name.toLowerCase();
  mostrarLoader("Analizando informe clínico...");

  // Simula análisis con retardo y selección del resultado según nombre
  await new Promise(r => setTimeout(r, 1200));

  if (nombre.includes("renal")) return renderResultados(resultadosDemo.renal);
  if (nombre.includes("diabetes")) return renderResultados(resultadosDemo.diabetes);
  renderResultados(resultadosDemo.normal);
}

async function enviarValores() {
  mostrarLoader("Ejecutando clasificación con los valores introducidos...");
  await new Promise(r => setTimeout(r, 1000));
  renderResultados(resultadosDemo.normal);
}

function renderResultados(data) {
  const cont = document.getElementById("resultado");
  cont.innerHTML = "";
  const cohortes = data.cohortes || {};
  const explicacion = data.explicacion || "Sin observaciones clínicas relevantes.";

  Object.entries(cohortes).forEach(([nombre, valor]) => {
    const color = valor > 70 ? "#e53935" : valor > 40 ? "#f9a825" : "#43a047";
    cont.insertAdjacentHTML("beforeend", `
      <div class="mb-4">
        <div class="flex justify-between text-sm font-medium mb-1">
          <span>${nombre}</span><span>${valor}%</span>
        </div>
        <div class="progress-bar"><div class="progress-inner" style="width:${valor}%; background:${color};"></div></div>
      </div>
    `);
  });

  cont.insertAdjacentHTML("beforeend", `
    <div class="mt-8 p-4 bg-gray-50 border rounded-md">
      <h4 class="font-semibold mb-2 text-gray-700">Resumen clínico</h4>
      <p class="text-sm text-gray-600 leading-relaxed">${explicacion}</p>
    </div>
  `);
}

function mostrarLoader(text) {
  document.getElementById("resultado").innerHTML = `
    <div class="flex flex-col items-center justify-center text-gray-500 py-10">
      <svg class="animate-spin h-6 w-6 mb-2 text-[var(--verde)]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
      </svg>
      <p>${text}</p>
    </div>`;
}
</script>
</body>
</html>
