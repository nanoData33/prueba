<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CohortIQ — Depuración de gráficos</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
:root {
  --verde: #3d7658;
  --verde-claro: #4ba67d;
  --gris-fondo: #f8f9f8;
}
body {
  background-color: var(--gris-fondo);
  font-family: 'Inter', sans-serif;
}
.card {
  background: white;
  border-radius: 0.8rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  padding: 1rem 1.5rem;
}
.modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.45);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 50;
}
.chat-btn {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--verde);
  color: white;
  border-radius: 50%;
  width: 60px; height: 60px;
  display: flex; justify-content: center; align-items: center;
  font-size: 28px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.25);
  cursor: pointer;
  transition: transform 0.2s ease;
}
.chat-btn:hover { transform: scale(1.1); background: var(--verde-claro); }
</style>
</head>

<body class="p-6">
<header class="flex justify-between items-center mb-6">
  <div class="flex items-center gap-3">
    <i data-lucide="activity" class="text-[var(--verde)]"></i>
    <h1 class="text-2xl font-semibold text-[var(--verde)]">CohortIQ</h1>
    <span class="text-gray-500 text-sm">Depuración de gráficos</span>
  </div>
</header>

<main class="space-y-6 max-w-3xl mx-auto">
  <section class="card">
    <h2 class="text-[var(--verde)] font-semibold mb-3">Probar consulta personalizada</h2>
    <div class="flex gap-2">
      <input id="inputConsulta" placeholder="Ej: histograma de edad por sexo"
        class="flex-grow border border-gray-300 rounded-md p-2 text-sm">
      <button onclick="enviarConsulta()" class="bg-[var(--verde)] text-white px-4 rounded-md">Enviar</button>
    </div>
  </section>
</main>

<!-- Modal del resultado -->
<div id="resultadoModal" class="modal hidden">
  <div class="bg-white p-6 rounded-lg shadow-lg w-[80%] max-w-3xl h-[70%] overflow-auto flex flex-col">
    <div class="flex justify-between items-center mb-3">
      <h3 class="text-lg font-semibold text-[var(--verde)]">Respuesta de n8n</h3>
      <button onclick="cerrarModal()" class="bg-[var(--verde)] text-white px-3 py-1 rounded-md text-sm">Cerrar</button>
    </div>
    <pre id="contenidoRespuesta" class="text-xs text-gray-800 whitespace-pre-wrap bg-gray-50 border border-gray-200 rounded-md p-3 flex-grow"></pre>
  </div>
</div>

<script>
lucide.createIcons();

async function enviarConsulta() {
  const consulta = document.getElementById("inputConsulta").value.trim();
  if (!consulta) return alert("Escribe una consulta primero.");

  const modal = document.getElementById("resultadoModal");
  const pre = document.getElementById("contenidoRespuesta");
  pre.textContent = "Cargando...";
  modal.classList.remove("hidden");

  try {
    const res = await fetch("https://rubaseval.app.n8n.cloud/webhook-test/grafico", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ consulta })
    });

    let texto = await res.text();
    try { texto = JSON.stringify(JSON.parse(texto), null, 2); } catch {}
    pre.textContent = texto;

  } catch (e) {
    pre.textContent = "Error al contactar con el webhook:\n\n" + e.message;
  }
}

function cerrarModal() {
  document.getElementById("resultadoModal").classList.add("hidden");
}
</script>
</body>
</html>
