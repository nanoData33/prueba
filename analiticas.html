<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üß¨ Clasificador Cl√≠nico Inteligente</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: "Inter", sans-serif; background: #f1f4f9; color: #1b1b1b; }
  .card { background: white; border-radius: 1rem; padding: 2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.05); max-width: 900px; margin:auto; }
  .btn-primary { background: #00897b; color:white; padding:0.75rem 1.5rem; border-radius:0.5rem; font-weight:600; transition:0.2s; }
  .btn-primary:hover { background: #00695c; }
  .progress-bar { height: 12px; border-radius: 9999px; background-color: #e5e7eb; overflow:hidden; }
  .progress-inner { height: 100%; border-radius: 9999px; }
</style>
</head>

<body class="py-10">

<h1 class="text-3xl font-bold text-center mb-8 text-gray-800">ü©∫ Clasificador Cl√≠nico Inteligente</h1>

<div class="card">
  <h2 class="text-xl font-semibold mb-4 text-teal-800">1Ô∏è‚É£ Subir PDF de Anal√≠tica</h2>
  <input type="file" id="pdfFile" accept=".pdf" class="mb-3 w-full border p-2 rounded-md">
  <button class="btn-primary w-full mb-6" onclick="enviarPDF()">üì§ Analizar PDF</button>

  <hr class="my-6">

  <h2 class="text-xl font-semibold mb-4 text-teal-800">2Ô∏è‚É£ Introducir Valores Manualmente</h2>
  <p class="text-sm text-gray-500 mb-3">Puedes modificar los valores para probar el clasificador.</p>

  <div class="grid grid-cols-3 gap-3 mb-4">
    <input id="glucosa" placeholder="Glucosa (mg/dL)" class="border p-2 rounded-md" value="198">
    <input id="hba1c" placeholder="HbA1c (%)" class="border p-2 rounded-md" value="8.2">
    <input id="colesterol_total" placeholder="Colesterol total (mg/dL)" class="border p-2 rounded-md" value="245">
    <input id="hdl" placeholder="HDL (mg/dL)" class="border p-2 rounded-md" value="38">
    <input id="ldl" placeholder="LDL (mg/dL)" class="border p-2 rounded-md" value="165">
    <input id="trigliceridos" placeholder="Triglic√©ridos (mg/dL)" class="border p-2 rounded-md" value="260">
    <input id="urea" placeholder="Urea (mg/dL)" class="border p-2 rounded-md" value="48">
    <input id="creatinina" placeholder="Creatinina (mg/dL)" class="border p-2 rounded-md" value="1.3">
    <input id="tsh" placeholder="TSH (uUI/mL)" class="border p-2 rounded-md" value="2.3">
    <input id="t3_libre" placeholder="T3 libre (pg/mL)" class="border p-2 rounded-md" value="3.0">
    <input id="alt" placeholder="ALT (U/L)" class="border p-2 rounded-md" value="45">
    <input id="ast" placeholder="AST (U/L)" class="border p-2 rounded-md" value="32">
    <input id="sodio" placeholder="Sodio (mmol/L)" class="border p-2 rounded-md" value="138">
    <input id="potasio" placeholder="Potasio (mmol/L)" class="border p-2 rounded-md" value="4.6">
    <input id="vitamina_d" placeholder="Vitamina D (ng/mL)" class="border p-2 rounded-md" value="28">
  </div>

  <button class="btn-primary w-full mb-4" onclick="enviarValores()">‚öôÔ∏è Ejecutar Clasificaci√≥n</button>
  
  <div id="resultado" class="mt-6"></div>
</div>

<script>
const n8nWebhook = "https://nano33.app.n8n.cloud/webhook-test/diagnostico"; // ‚Üê Tu webhook n8n

// === OPCI√ìN 1: Subida de PDF ===
async function enviarPDF() {
  const fileInput = document.getElementById("pdfFile");
  if (!fileInput.files.length) return alert("Selecciona un PDF primero.");

  const formData = new FormData();
  formData.append("file", fileInput.files[0]);
  formData.append("tipo", "pdf");

  document.getElementById("resultado").innerHTML = "‚è≥ Enviando PDF a n8n...";

  try {
    const res = await fetch(n8nWebhook, { method: "POST", body: formData });
    const data = await res.json();
    mostrarResultado(data);
  } catch (e) {
    document.getElementById("resultado").innerHTML = "‚ùå Error al enviar el PDF.";
  }
}

// === OPCI√ìN 2: Datos manuales ===
async function enviarValores() {
  const campos = document.querySelectorAll("input");
  const payload = {};
  campos.forEach(c => payload[c.id] = parseFloat(c.value) || null);

  document.getElementById("resultado").innerHTML = "‚è≥ Analizando valores...";

  try {
    const res = await fetch(n8nWebhook, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    mostrarResultado(data);
  } catch (e) {
    document.getElementById("resultado").innerHTML = "‚ùå Error al enviar los valores.";
  }
}

// === VISUALIZACI√ìN ===
function mostrarResultado(data) {
  if (!data) return;
  const cont = document.getElementById("resultado");
  cont.innerHTML = "";

  const title = document.createElement("h3");
  title.className = "text-xl font-semibold mb-3 text-gray-800";
  title.textContent = "üß© Resultados del Clasificador";
  cont.appendChild(title);

  const enfermedades = Object.entries(data).filter(([k,v]) => typeof v === "number");
  const variables = data["Variables dominantes"] || [];

  // Barras de probabilidad
  enfermedades.forEach(([nombre, valor]) => {
    const color = valor > 70 ? "#d32f2f" : valor > 40 ? "#f9a825" : "#388e3c";
    const row = document.createElement("div");
    row.className = "mb-3";
    row.innerHTML = `
      <div class="flex justify-between text-sm font-medium mb-1">
        <span>${nombre}</span>
        <span>${valor}%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-inner" style="width:${valor}%; background:${color};"></div>
      </div>`;
    cont.appendChild(row);
  });

  // Variables dominantes
  const varsBox = document.createElement("div");
  varsBox.className = "mt-6 p-3 bg-gray-50 rounded-md border border-gray-200";
  varsBox.innerHTML = `
    <h4 class="font-semibold mb-2 text-gray-700">üß† Variables m√°s influyentes</h4>
    <p class="text-sm text-gray-600">${variables.length ? variables.join(", ") : "Sin alteraciones destacables."}</p>
  `;
  cont.appendChild(varsBox);

  // Cohorte principal
  const maxCohorte = enfermedades.sort((a,b) => b[1]-a[1])[0];
  if (maxCohorte && maxCohorte[1] > 60) {
    const boton = document.createElement("button");
    boton.className = "btn-primary mt-5";
    boton.textContent = `üîç Ver detalles del cohorte: ${maxCohorte[0]}`;
    boton.onclick = () => alert(`A√∫n no implementado: vista detallada para ${maxCohorte[0]}`);
    cont.appendChild(boton);
  }
}
</script>

</body>
</html>
