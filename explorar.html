<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Explorar Base de Datos</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { background-color: #f5f3f0; font-family: "Inter", sans-serif; }
    .table-container { overflow-x: auto; background: white; border-radius: 0.5rem; padding: 1rem; box-shadow: 0 3px 6px rgba(0,0,0,0.08); }
    input, select { border: 1px solid #d4d4d4; border-radius: 0.4rem; padding: 0.4rem 0.6rem; }
    button { background: #1c1c1b; color: white; border-radius: 0.4rem; padding: 0.5rem 1rem; font-weight: 500; }
    button:hover { background: #2b2b29; }
  </style>
</head>

<body class="p-8">
  <h1 class="text-2xl font-semibold mb-6">Explorador de Base de Datos</h1>

  <div class="mb-6 flex gap-3">
    <input id="nombre" placeholder="Nombre" />
    <input id="apellido" placeholder="Apellido" />
    <input id="edad" type="number" placeholder="Edad" />
    <input id="enfermedad" placeholder="Enfermedad principal" />
    <button onclick="insertar()">A√±adir Paciente</button>
  </div>

  <div class="table-container">
    <table class="min-w-full text-sm text-left">
      <thead class="border-b font-semibold">
        <tr><th>ID</th><th>Nombre</th><th>Edad</th><th>Enfermedad</th><th>Acciones</th></tr>
      </thead>
      <tbody id="tablaPacientes"></tbody>
    </table>
  </div>

  <script>
    const supabaseUrl = "https://tmolxeszsgkffurhrcxy.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtb2x4ZXN6c2drZmZ1cmhyY3h5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5ODA4NDgsImV4cCI6MjA3NjU1Njg0OH0.UAEsNX7CpFXbns9ONynstAAKdcvmZUfsX5J6cOTE6Pw";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function cargar() {
      const { data, error } = await supabase.from("pacientes").select("patient_id, nombre, edad, enfermedad_principal");
      if (error) { console.error(error); return; }

      document.getElementById("tablaPacientes").innerHTML = data.map(p => `
        <tr class="border-b">
          <td>${p.patient_id}</td>
          <td contenteditable onblur="editar('${p.patient_id}','nombre',this.innerText)">${p.nombre || ""}</td>
          <td contenteditable onblur="editar('${p.patient_id}','edad',this.innerText)">${p.edad || ""}</td>
          <td contenteditable onblur="editar('${p.patient_id}','enfermedad_principal',this.innerText)">${p.enfermedad_principal || ""}</td>
          <td><button onclick="eliminar('${p.patient_id}')">üóëÔ∏è</button></td>
        </tr>
      `).join("");
    }

    async function insertar() {
      const nombre = document.getElementById("nombre").value;
      const apellido = document.getElementById("apellido").value;
      const edad = parseInt(document.getElementById("edad").value);
      const enfermedad = document.getElementById("enfermedad").value;

      if (!nombre) return alert("Introduce al menos el nombre.");

      const { error } = await supabase.from("pacientes").insert([{ nombre, apellido, edad, enfermedad_principal: enfermedad }]);
      if (error) { console.error(error); alert("Error al insertar."); return; }
      cargar();
    }

    async function editar(id, campo, valor) {
      const { error } = await supabase.from("pacientes").update({ [campo]: valor }).eq("patient_id", id);
      if (error) console.error(error);
    }

    async function eliminar(id) {
      if (!confirm("¬øSeguro que deseas eliminar este paciente?")) return;
      const { error } = await supabase.from("pacientes").delete().eq("patient_id", id);
      if (error) console.error(error);
      cargar();
    }

    cargar();
  </script>
</body>
</html>
